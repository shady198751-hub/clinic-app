<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ ÙÙŠ Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø³Ø§Ø¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ØªØ®ØµÙŠØµ Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 1;
            cursor: pointer;
            filter: invert(0.5);
        }
        .icon-size {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 50;
        }
        #main-content-wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
    </style>
</head>
<body>
    <div id="main-content-wrapper">
        <div id="booking-container" class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-teal-100/50">
            
            <div class="p-3 bg-yellow-100 border border-yellow-300 text-yellow-800 rounded-lg text-sm mb-6 text-center font-medium">
                <p>Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² ØªØ­Øª Ø§Ù„ØªØ¬Ø±Ø¨Ø©.</p>
            </div>

            <header class="text-center mb-8">
                <div class="flex items-center justify-center mb-3 text-teal-600">
                    <i data-lucide="stethoscope" class="icon-size mr-2"></i>
                    <h1 class="text-3xl font-extrabold text-teal-700">Ø­Ø¬Ø² Ø¹ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø§Ø¡</h1>
                </div>
                <p class="text-gray-500 mt-2 text-lg">Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ø®Ø¯Ù…ØªÙƒ. ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù„Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ.</p>
            </header>

            <form id="booking-form" class="space-y-6">

                <div>
                    <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i data-lucide="user" class="icon-size ml-2"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„
                    </label>
                    <input type="text" id="fullName" name="fullName" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500 transition duration-150 ease-in-out"
                            placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø«Ù„Ø§Ø«ÙŠØ§Ù‹">
                </div>

                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i data-lucide="phone" class="icon-size ml-2"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
                    </label>
                    <input type="tel" id="phone" name="phone" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500 transition duration-150 ease-in-out"
                            placeholder="Ù…Ø«Ø§Ù„: 05xxxxxxx">
                </div>

                <div>
                    <label for="doctorName" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i data-lucide="user-check" class="icon-size ml-2"></i> Ø§Ø³Ù… Ø§Ù„Ø·Ø¨ÙŠØ¨
                    </label>
                    <select id="doctorName" name="doctorName" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500 transition duration-150 ease-in-out">
                        <option value="" disabled selected>Ø§Ø®ØªØ± Ø·Ø¨ÙŠØ¨Ø§Ù‹</option>
                        <option value="Ø¯ÙƒØªÙˆØ± Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯">Ø¯ÙƒØªÙˆØ± Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯</option>
                        <option value="Ø¯ÙƒØªÙˆØ± Ù†Ø´ÙˆÙŠ Ø§Ø³Ø§Ù…Ù‡">Ø¯ÙƒØªÙˆØ± Ù†Ø´ÙˆÙŠ Ø§Ø³Ø§Ù…Ù‡</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <i data-lucide="calendar-check" class="icon-size ml-2"></i> Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                        </label>
                        <input type="date" id="date" name="date" required
                                class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500 transition duration-150 ease-in-out">
                    </div>
                    
                    <div>
                        <label for="fileNumber" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <i data-lucide="folder-open" class="icon-size ml-2"></i> Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù (Ø¥Ù† ÙˆØ¬Ø¯)
                        </label>
                        <input type="text" id="fileNumber" name="fileNumber" 
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500 transition duration-150 ease-in-out"
                            placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙŠØ¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    </div>
                </div>

                <div id="date-warning" class="hidden p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg flex items-center text-sm">
                    <i data-lucide="alert-triangle" class="icon-size w-5 h-5 ml-2 flex-shrink-0"></i>
                    <span id="warning-text"></span>
                </div>

                <div id="schedule-feedback" class="hidden"></div>

                <button type="submit" id="submitBtn"
                        class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition duration-300 ease-in-out transform hover:scale-[1.01]">
                    <span id="button-text">ØªØ£ÙƒÙŠØ¯ ÙˆØ­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯</span>
                    <i data-lucide="send" class="icon-size mr-2"></i>
                </button>
                
                <div id="status-message" class="mt-4 p-4 rounded-lg text-center hidden" role="alert"></div>

            </form>
        </div>
    </div>

    <div id="success-modal" class="hidden fixed inset-0 flex items-center justify-center modal-backdrop z-50">
        <div id="modal-content" class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                    <i data-lucide="check-circle" class="icon-size w-6 h-6 text-green-600"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900" id="modal-title">ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</h3>
                <div class="mt-4">
                    <p class="text-sm text-gray-500">
                        Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! Ù„Ù‚Ø¯ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ. Ø³ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø·Ø¨ÙŠ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.
                    </p>
                    <div class="mt-4 p-2 bg-gray-50 rounded-lg text-xs text-gray-600">
                        <p class="font-medium">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø·Ø¨ÙŠØ¨:</p>
                        <p id="booked-details"></p>
                    </div>
                </div>
            </div>
            <div class="mt-6">
                <button type="button" id="close-modal-btn"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-teal-600 text-base font-medium text-white hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition duration-150">
                    Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª
                </button>
            </div>
        </div>
    </div>
    
    <footer class="mt-auto p-4 text-center text-xs text-gray-500 border-t border-gray-200 bg-gray-50">
        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©. Â© 2025 Ù…Ø³ØªØ´ÙÙ‰ ØªØ¨Ø§Ø±Ùƒ Ù„Ù„ÙˆÙ„Ø§Ø¯Ø© ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„. | Designed By Shady Yassin
    </footer>

    <script>
        // ØªØ­Ø¯ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ø¹Ù…Ù„ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ (0=Ø§Ù„Ø£Ø­Ø¯, 6=Ø§Ù„Ø³Ø¨Øª)
        const DOCTOR_SCHEDULES = {
            "Ø¯ÙƒØªÙˆØ± Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯": [6, 1, 3], 
            "Ø¯ÙƒØªÙˆØ± Ù†Ø´ÙˆÙŠ Ø§Ø³Ø§Ù…Ù‡": [0, 3, 4, 5], 
        };

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const form = document.getElementById('booking-form');
            const submitBtn = document.getElementById('submitBtn');
            const buttonText = document.getElementById('button-text');
            const statusMessage = document.getElementById('status-message');
            
            const successModal = document.getElementById('success-modal');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const bookedDetails = document.getElementById('booked-details');
            
            const dateInput = document.getElementById('date');
            const doctorSelect = document.getElementById('doctorName');
            const scheduleFeedback = document.getElementById('schedule-feedback');
            const warningText = document.getElementById('warning-text'); 
            
            const REDIRECT_URL = 'https://tabarakmariouteya.site/'; 

            const today = new Date().toISOString().split('T')[0];
            dateInput.setAttribute('min', today);


            // ğŸŸ¢ Ø±Ø§Ø¨Ø· Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Endpoint) Ø§Ù„Ø¢Ù…Ù† ÙˆØ§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (HTTPS)
            const VPS_ENDPOINT_URL = 'https://c.tabarakmariouteya.site/process-booking'; 
            
            // ğŸŸ¢ Ù…Ø¹Ø±Ù‘ÙØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ (Entry IDs) Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.
            const FORM_FIELDS = {
                fullName: 'entry.1099054873',
                phone: 'entry.1290164613',
                date: 'entry.1192964186',
                fileNumber: 'entry.1482290468',
                doctorName: 'entry.1102654140'
            };

            const DAYS_OF_WEEK = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];

            // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆØ§ÙÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨
            const validateSchedule = () => {
                const selectedDate = dateInput.value;
                const selectedDoctor = doctorSelect.value;
                
                if (!selectedDoctor || !selectedDate) {
                    scheduleFeedback.classList.add('hidden');
                    submitBtn.disabled = true; 
                    return false; 
                }

                const dateObj = new Date(selectedDate + 'T00:00:00'); 
                const dayOfWeek = dateObj.getDay(); 
                const doctorSchedule = DOCTOR_SCHEDULES[selectedDoctor];
                
                let isValid = false;
                let availableDaysText = '';

                if (doctorSchedule) {
                    if (doctorSchedule.includes(dayOfWeek)) {
                        isValid = true;
                    }

                    const availableDays = doctorSchedule.map(dayIndex => DAYS_OF_WEEK[dayIndex]).join('ØŒ ');
                    availableDaysText = availableDays;
                } else {
                    isValid = false; 
                    availableDaysText = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø¨ÙŠØ¨ Ø¢Ø®Ø±.'; 
                }

                scheduleFeedback.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-700');
                scheduleFeedback.classList.add('p-3', 'rounded-lg', 'text-sm', 'text-right', 'mt-4', 'flex', 'items-center');

                if (isValid) {
                    scheduleFeedback.classList.remove('bg-red-100', 'text-red-800');
                    scheduleFeedback.classList.add('bg-green-100', 'text-green-700');
                    scheduleFeedback.innerHTML = `<i data-lucide="check-circle" class="icon-size ml-2"></i> Ù…ÙˆØ¹Ø¯ Ù…ØªØ§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­Ø¬Ø².`;
                    submitBtn.disabled = false;
                } else {
                    scheduleFeedback.classList.remove('bg-green-100', 'text-green-700');
                    scheduleFeedback.classList.add('bg-red-100', 'text-red-800');
                    scheduleFeedback.innerHTML = `<i data-lucide="x-circle" class="icon-size ml-2"></i> Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø¬Ø². Ù…ÙˆØ§Ø¹ÙŠØ¯ ${selectedDoctor} Ø§Ù„Ù…ØªØ§Ø­Ø© Ù‡ÙŠ: <span class="font-bold">${availableDaysText}</span>`;
                    submitBtn.disabled = true;
                }
                lucide.createIcons();
                return isValid;
            };

            dateInput.addEventListener('change', validateSchedule);
            doctorSelect.addEventListener('change', validateSchedule);
            validateSchedule();


            const showSuccessModal = (date, doctor) => {
                const dateParts = date.split('-'); 
                const formattedDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`; 

                bookedDetails.textContent = `${formattedDate} - ${doctor}`;
                successModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            };

            const hideSuccessModal = () => {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    successModal.classList.add('hidden');
                    window.location.href = REDIRECT_URL; 
                }, 300); 
            };

            closeModalBtn.addEventListener('click', hideSuccessModal);
            successModal.addEventListener('click', (e) => {
                if (e.target === successModal) {
                    hideSuccessModal();
                }
            });

            const showStatusMessage = (message, type) => {
                statusMessage.innerHTML = message;
                statusMessage.classList.remove('hidden', 'bg-red-100', 'text-red-800');
                
                if (type === 'error') {
                    statusMessage.classList.add('bg-red-100', 'text-red-800');
                }
                statusMessage.classList.remove('hidden');
            };
            
            const submitFormToVPS = async (formData) => {
                const bookingData = {};
                for (const [key, value] of formData.entries()) {
                    bookingData[key] = value;
                }
                
                // ğŸ›‘ ØªØ­ÙˆÙŠÙ„ Ø­Ù‚Ù„ 'fullName' Ù…Ù† Ø§Ù„Ù€ HTML Ø¥Ù„Ù‰ 'childName' Ù„ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ ÙƒÙˆØ¯ server.js
                // (Ø­ÙŠØ« ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… 'childName' Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰)
                bookingData.childName = bookingData.fullName; 
                delete bookingData.fullName;

                try {
                    const response = await fetch(VPS_ENDPOINT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            booking: bookingData, 
                            form_fields: FORM_FIELDS 
                        })
                    });

                    const result = await response.json();

                    if (response.ok && result.status === 'success') {
                        showSuccessModal(bookingData.date, bookingData.doctorName);
                        form.reset();
                        validateSchedule();
                        showStatusMessage('', 'success'); 

                    } else if (result.status === 'full') {
                        // Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø­Ø¬Ø² (ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ ØªØ¬Ø§ÙˆØ² 20 Ø£Ùˆ 40)
                        const message = `Ù„Ù„Ø£Ø³ÙØŒ Ø§ÙƒØªÙ…Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø·Ø¨ÙŠØ¨. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù‡Ùˆ ${result.limit}`;
                        showStatusMessage(message, 'error');

                    } else {
                        const message = result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø¬Ø².';
                        showStatusMessage(message, 'error');
                    }

                } catch (error) {
                    console.error('Submission Error:', error);
                    let errorMessage = `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©: ÙØ´Ù„ ØªÙˆØ¬ÙŠÙ‡ HTTPS. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Nginx ÙŠØ¹Ù…Ù„ Ù„Ù€ ${new URL(VPS_ENDPOINT_URL).hostname}.`;
                    showStatusMessage(errorMessage, 'error'); 
                } finally {
                    submitBtn.disabled = false;
                    buttonText.textContent = 'ØªØ£ÙƒÙŠØ¯ ÙˆØ­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯';
                }
            };


            const submitHandler = (e) => {
                e.preventDefault();
                
                if (!validateSchedule() || submitBtn.disabled) {
                    showStatusMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® ÙˆØ·Ø¨ÙŠØ¨ Ù…ØªØ§Ø­ÙŠÙ† Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ø¬Ø².', 'error');
                    return;
                }

                statusMessage.classList.add('hidden');
                submitBtn.disabled = true;
                buttonText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„...';
                
                const formData = new FormData(form);
                submitFormToVPS(formData);
            };

            form.addEventListener('submit', submitHandler);
            validateSchedule();
        });
    </script>
</body>
</html>
