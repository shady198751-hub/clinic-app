<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุญุฌุฒ ููุนุฏ ูู ุนูุงุฏุฉ ุงูุฃุทูุงู - API ุฎุงุฑุฌู</title>
    <!-- ุชุถููู Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ุชุถููู ุฃููููุงุช Lucide React for modern icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ุชุฎุตูุต ุฎุท Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* ููู ุฎูููุฉ ูุงุชุญ */
            display: flex; /* ูุถูุงู ุชูุฑูุฒ ุงููุญุชูู ูุงูุชุฐููู */
            flex-direction: column;
            min-height: 100vh;
        }
        /* ุชุตููู ุญูู ุงูุชุงุฑูุฎ ููุชูุงูู ูุน ุงููุบุฉ ุงูุนุฑุจูุฉ */
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 1;
            cursor: pointer;
            filter: invert(0.5); /* ูุฌุนู ุงูุฃููููุฉ ูุฑุฆูุฉ ุจุดูู ุฌูุฏ */
        }
        .icon-size {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
        /* ุชุตููู ุงููุงูุฐุฉ ุงูููุจุซูุฉ (Modal) */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 50;
        }
        /* ูุถูุงู ุชูุณูุท ูุญุชูู ุงูุญุฌุฒ ูุฌุนูู ูุฑูุงู */
        #main-content-wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem; /* padding: p-4 md:p-8 */
        }
        /* ุฅุถุงูุฉ ุฏูุฑุงู ููุคุดุฑ ุงูุชุญููู */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div id="main-content-wrapper">
        <div id="booking-container" class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-blue-100/50">
            
            <!-- ุชู ุฅุฒุงูุฉ ุชูุจูู ุงููุธุงู ุงููุชุตู ุจุงูุฎุงุฏู ุงูุฎุงุฑุฌู -->

            <!-- ุนููุงู ุงูุชุทุจูู -->
            <header class="text-center mb-8">
                <div class="flex items-center justify-center mb-3 text-blue-600">
                    <i data-lucide="baby" class="icon-size mr-2"></i>
                    <h1 class="text-3xl font-extrabold text-blue-700">ุญุฌุฒ ุนูุงุฏุงุช ุงูุฃุทูุงู</h1>
                </div>
                <p class="text-gray-500 mt-2 text-lg">ูุญู ููุง ูุฎุฏูุฉ ุทููู. ูุฑุฌู ููุก ุงูุชูุงุตูู ูุญุฌุฒ ููุนุฏู.</p>
            </header>

            <!-- ูููุฐุฌ ุงูุญุฌุฒ -->
            <form id="booking-form" class="space-y-6">

                <!-- ุญูู ุงุณู ุงูุทูู -->
                <div>
                    <label for="childName" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i data-lucide="smile" class="icon-size ml-2"></i>
                        ุงุณู ุงูุทูู
                    </label>
                    <input type="text" id="childName" name="childName" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"
                            placeholder="ุงุฏุฎู ุงุณู ุงูุทูู">
                </div>

                <!-- ุญูู ุฑูู ุงููุงุชู -->
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i data-lucide="phone" class="icon-size ml-2"></i>
                        ุฑูู ุงููุงุชู
                    </label>
                    <input type="tel" id="phone" name="phone" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"
                            placeholder="ูุซุงู: 05xxxxxxx">
                </div>

                <!-- ุญูู ุงุณู ุงูุทุจูุจ -->
                <div>
                    <label for="doctorName" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i data-lucide="user-check" class="icon-size ml-2"></i>
                        ุงุณู ุทุจูุจ ุงูุฃุทูุงู
                    </label>
                    <select id="doctorName" name="doctorName" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                        <option value="" disabled selected>ุงุฎุชุฑ ุทุจูุจุงู</option>
                        <option value="ุฏูุชูุฑ ุนุจุฏ ุงูุบูุงุฑ ุทู">ุฏูุชูุฑ ุนุจุฏ ุงูุบูุงุฑ ุทู</option>
                        <option value="ุฏูุชูุฑ ุนูุงุก ุงูุณุจุงุนู">ุฏูุชูุฑ ุนูุงุก ุงูุณุจุงุนู</option>
                        <option value="ุฏูุชูุฑ ูุญูุฏ ูุณูู">ุฏูุชูุฑ ูุญูุฏ ูุณูู</option>
                    </select>
                </div>

                <!-- ุญูู ุงูุชุงุฑูุฎ ูุฑูู ุงูููู -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <i data-lucide="calendar-check" class="icon-size ml-2"></i>
                            ุงูุชุงุฑูุฎ ุงููุทููุจ
                        </label>
                        <input type="date" id="date" name="date" required
                                class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>
                    
                    <!-- ุญูู ุฑูู ุงูููู -->
                    <div>
                        <label for="fileNumber" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <i data-lucide="folder-open" class="icon-size ml-2"></i>
                            ุฑูู ุงูููู (ุฅู ูุฌุฏ)
                        </label>
                        <input type="text" id="fileNumber" name="fileNumber" 
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"
                            placeholder="ุงุฏุฎู ุฑูู ููู ุงููุฑูุถ (ุงุฎุชูุงุฑู)">
                    </div>
                </div>

                <!-- ุฑุณุงูุฉ ุงูุชุญุฐูุฑ ูู ุงูุชุงุฑูุฎ ุบูุฑ ุงููุชุงุญ ุฃู ุชุฌุงูุฒ ุงูุณุนุฉ -->
                <div id="date-warning" class="hidden p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg flex items-center text-sm">
                    <i data-lucide="alert-triangle" class="icon-size w-5 h-5 ml-2 flex-shrink-0"></i>
                    <span id="warning-text"></span>
                </div>

                <!-- ุนุฑุถ ุนุฏุฏ ุงูุญุฌูุฒุงุช ุงูููููุฉ ุงููุชุจููุฉ -->
                <div id="daily-limit-info" class="p-3 bg-blue-50 border border-blue-200 text-blue-800 rounded-lg text-sm hidden font-medium text-center">
                    <i data-lucide="info" class="icon-size w-4 h-4 ml-1 inline-block align-middle"></i>
                    <span id="current-count-text"></span>
                </div>

                <!-- ุฒุฑ ุงูุฅุฑุณุงู -->
                <button type="submit" id="submitBtn" disabled
                        class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:scale-[1.01] disabled:transform-none">
                    <span id="button-text">ุชุฃููุฏ ูุญุฌุฒ ุงูููุนุฏ</span>
                    <i id="button-icon" data-lucide="send" class="icon-size mr-2"></i>
                </button>
                
                <!-- ุฑุณุงูุฉ ุงูุญุงูุฉ (ุฎุทุฃ) -->
                <div id="status-message" class="mt-4 p-4 rounded-lg text-center hidden" role="alert"></div>

            </form>
        </div>
    </div>

    <!-- ุงููุงูุฐุฉ ุงูููุจุซูุฉ ูููุฌุงุญ (Success Modal) -->
    <div id="success-modal" class="hidden fixed inset-0 flex items-center justify-center modal-backdrop z-50">
        <div id="modal-content" class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                    <i data-lucide="check-circle" class="icon-size w-6 h-6 text-green-600"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900" id="modal-title">ุชู ุงูุญุฌุฒ ุจูุฌุงุญ!</h3>
                <div class="mt-4">
                    <p class="text-sm text-gray-500">
                        ุดูุฑุงู ูู! ููุฏ ุชู ุฅุฑุณุงู ุทูุจ ุญุฌุฒ ููุนุฏู. ุณูุชู ุงูุงุชุตุงู ุจู ูุฑูุจุงู ูู ูุจู ุงููุฑูู ุงูุทุจู ูุชุฃููุฏ ุงูููุนุฏ ุงูููุงุฆู.
                    </p>
                    <div class="mt-4 p-2 bg-gray-50 rounded-lg text-xs text-gray-600">
                        <p class="font-medium">ุงูุชุงุฑูุฎ ูุงูุทุจูุจ:</p>
                        <p id="booked-details"></p>
                    </div>
                </div>
            </div>
            <div class="mt-6">
                <button type="button" id="close-modal-btn"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150">
                    ุญุณูุงูุ ูููุช
                </button>
            </div>
        </div>
    </div>
    
    <!-- ุชุฐููู ุงูุตูุญุฉ -->
    <footer class="mt-auto p-4 text-center text-xs text-gray-500 border-t border-gray-200 bg-gray-50">
        ุฌููุน ุงูุญููู ูุญููุธุฉ. ยฉ 2025 ูุณุชุดูู ุชุจุงุฑู ููููุงุฏุฉ ูุงูุฃุทูุงู. | Designed By Shady Yassin
    </footer>

    <!-- ููุฏ JavaScript ููุชุนุงูู ูุน ุงูุฅุฑุณุงู ุฅูู API ู Google Form -->
    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {

            lucide.createIcons(); // ุชููุฆุฉ ุงูุฃููููุงุช
            
            // ๐ด ููุทุฉ ููุงูุฉ API ุงูุฎุงุตุฉ ุจู ุงูุชู ุณุชููู ุจุงูุชุญูู ูุงูุญูุธ ูู ูุงุนุฏุฉ ุจูุงูุงุชู ุงูุฎุงุตุฉ
            // ุชู ุงูุชุญุฏูุซ ููุงุชุตุงู ุจุงูุฎุงุฏู ุงูุฎุงุต ุจู ุนูู Hostinger VPS
            const BOOKING_API_ENDPOINT = 'http://72.61.110.155:3000/api/book'; 
            
            // ๐ด ุงูุญุฏ ุงูุฃูุตู ููุญุฌูุฒุงุช ููู ุทุจูุจ ูู ุงูููู (ููุนุฑุถ ููุท - ุงููุฑุถ ูุชู ุนูู ุงูุฎุงุฏู)
            const MAX_BOOKINGS_PER_DOCTOR_PER_DAY = 5;

            // ๐ข 1. ุฑุงุจุท ุงูุฅุฑุณุงู ุงูุฎุงุต ุจูููุฐุฌ Google (ููุชุณุฌูู ุงูุซุงููู)
            const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeWNMGy0Zng3yN1NiBnwj5NFG19DXA4T15i2k1h1VYMggH1tw/formResponse';

            // ๐ข 2. ูุนุฑููุงุช ุงูุฏุฎูู (Entry IDs) ุงููุณุชุฎุฑุฌุฉ ูู Google Form.
            const FORM_FIELDS = {
                childName: 'entry.2084437554',
                phone: 'entry.1545096345',
                doctorName: 'entry.635361516',
                date: 'entry.612226324',
                fileNumber: 'entry.1813748108'
            };
            
            // ุฃูุงู ุงูุฃุณุจูุน (ุจุดูู ุฑููู: 0=ุงูุฃุญุฏุ 1=ุงูุงุซููู... 6=ุงูุณุจุช)
            const DAYS_OF_WEEK = ['ุงูุฃุญุฏ', 'ุงูุงุซููู', 'ุงูุซูุงุซุงุก', 'ุงูุฃุฑุจุนุงุก', 'ุงูุฎููุณ', 'ุงูุฌูุนุฉ', 'ุงูุณุจุช'];

            // ููุงุนุฏ ุงูุญุถูุฑ: ุฃูุงู ุงูุบูุงุจ (ุงูุฃุฑูุงู ุงูุชู ุชูุซู ุฃูุงู ุงูุฃุณุจูุน)
            const DOCTOR_ABSENCE = {
                'ุฏูุชูุฑ ุนุจุฏ ุงูุบูุงุฑ ุทู': [0, 4], // ุงูุฃุญุฏ (0) ูุงูุฎููุณ (4) ุบูุงุจ.
                'ุฏูุชูุฑ ุนูุงุก ุงูุณุจุงุนู': [5],ย ย // ุงูุฌูุนุฉ (5) ุบูุงุจ.
                'ุฏูุชูุฑ ูุญูุฏ ูุณูู': [5],ย ย ย ย// ุงูุฌูุนุฉ (5) ุบูุงุจ.
            };
            
            // =========================================================
            // ุงูุนูุงุตุฑ ุงูุฑุฆูุณูุฉ ูู DOM
            // =========================================================
            const form = document.getElementById('booking-form');
            const submitBtn = document.getElementById('submitBtn');
            const buttonText = document.getElementById('button-text');
            const buttonIcon = document.getElementById('button-icon');
            const statusMessage = document.getElementById('status-message');
            const successModal = document.getElementById('success-modal');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const bookedDetails = document.getElementById('booked-details');
            const dateInput = document.getElementById('date');
            const doctorNameInput = document.getElementById('doctorName');
            const dateWarning = document.getElementById('date-warning');
            const warningText = document.getElementById('warning-text');
            const dailyLimitInfo = document.getElementById('daily-limit-info');
            const currentCountText = document.getElementById('current-count-text');

            // ุชุนููู ุงูุญุฏ ุงูุฃุฏูู ูุชุงุฑูุฎ ุงูููู ูููุน ุงูุญุฌุฒ ูู ุงููุงุถู
            const today = new Date().toISOString().split('T')[0];
            dateInput.setAttribute('min', today);
            // =========================================================


            /**
             * ุฏุงูุฉ ููุชุญูู ุงููุญูู ูู ุชูุงูุฑ ุงูุทุจูุจ (ุณุฑูุนุฉ ููุง ุชุญุชุงุฌ ุดุจูุฉ).
             * @returns {boolean} - ูู ุงูุชุงุฑูุฎ ูุงูุทุจูุจ ูุชุงุญุงู (ุจุบุถ ุงููุธุฑ ุนู ุงูุณุนุฉ).
             */
            const checkLocalValidation = () => {
                const selectedDate = dateInput.value;
                const selectedDoctor = doctorNameInput.value;

                // ุฅุฎูุงุก ุงูุชุญุฐูุฑุงุช ูุงููุนูููุงุช ุงูุงูุชุฑุงุถูุฉ
                dateWarning.classList.add('hidden');
                dailyLimitInfo.classList.add('hidden');
                submitBtn.disabled = true;
                
                if (!selectedDoctor || !selectedDate) {
                    return false;
                }

                // 1. ุงูุชุญูู ูู ุฃูุงู ุบูุงุจ ุงูุทุจูุจ
                const dateObj = new Date(selectedDate + 'T00:00:00'); 
                const dayIndex = dateObj.getDay(); 
                const absenceDays = DOCTOR_ABSENCE[selectedDoctor];

                if (absenceDays && absenceDays.includes(dayIndex)) {
                    // ุงูุชุงุฑูุฎ ุบูุฑ ูุชุงุญ ุจุณุจุจ ุฌุฏูู ุนูู ุงูุทุจูุจ
                    const availableDaysIndices = [0, 1, 2, 3, 4, 5, 6].filter(day => !absenceDays.includes(day));
                    const availableDaysNames = availableDaysIndices.map(index => DAYS_OF_WEEK[index]);
                    const availabilityMessage = availableDaysNames.length > 0
                        ? availableDaysNames.join('ุ ')
                        : 'ูุง ููุฌุฏ ููุงุนูุฏ ูุชุงุญุฉ ูุฐุง ุงูุฃุณุจูุน.';

                    warningText.innerHTML = `ุงูุชุงุฑูุฎ ุงููุฎุชุงุฑ ุบูุฑ ูุชุงุญ ููุฏูุชูุฑ <strong>${selectedDoctor}</strong>. ูุฑุฌู ุงุฎุชูุงุฑ ููู ุขุฎุฑ.<br>ููุงุนูุฏ ุญุถูุฑู ุงููุชุงุญุฉ ูู: <strong>${availabilityMessage}</strong>.`;
                    dateWarning.classList.remove('hidden');
                    return false;
                }

                // ุฅุฐุง ูุงู ูู ุดูุก ูุญููุงู ุตุญูุญุงูุ ูุชู ุชูุนูู ุงูุฒุฑ ุงุณุชุนุฏุงุฏุงู ููุฅุฑุณุงู
                submitBtn.disabled = false;
                return true;
            };


            /**
             * ุฏุงูุฉ ูุฅุฑุณุงู ุจูุงูุงุช ุงูุญุฌุฒ ุฅูู API ุงูุฎุงุฑุฌู ููุชุญูู ูู ุงูุณุนุฉ ูุงูุญูุธ.
             * @param {object} bookingData - ุจูุงูุงุช ุงูุญุฌุฒ.
             * @returns {Promise<object>} - ุงุณุชุฌุงุจุฉ API.
             */
            const sendBookingToApi = async (bookingData) => {
                
                const response = await fetch(BOOKING_API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bookingData),
                });

                // ุฅุฐุง ูุงู ุงูุฎุงุฏู ูุฑุฏ ุจุฑูุฒ ุฎุทุฃ (ูุซู 403 ูุชุฌุงูุฒ ุงูุณุนุฉ)
                if (!response.ok) {
                    const errorResult = await response.json();
                    // ูุชู ุฑูู ุงูุฎุทุฃ ุงูุฐู ูุฃุชู ูู API (ูุซูุงู ุชุฌุงูุฒ ุงูุณุนุฉ)
                    throw new Error(errorResult.message || 'ูุดู ุงูุญุฌุฒ (ุฎุทุฃ ูู ุงุชุตุงู ุงูุฎุงุฏู). ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.');
                }
                
                // ุฅุฐุง ูุงู ุงูุฑุฏ ูุงุฌุญุงู (ุฑูุฒ 200)
                const result = await response.json();
                return result; 
            };


            // ๐ง ุฏุงูุฉ ูุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู Google Forms (ุฎุทูุฉ ุซุงูููุฉ) - ุชุนูู ูู ุงูุฎูููุฉ
            const submitFormToGoogleForms = async (formData) => {
                const data = new URLSearchParams();
                
                const childName = formData.get('childName');
                const date = formData.get('date');
                const doctor = formData.get('doctorName');
                
                // ุชุนุจุฆุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ูุนุฑููุงุช ุงูุญููู (Entry IDs)
                data.append(FORM_FIELDS.childName, childName);
                data.append(FORM_FIELDS.phone, formData.get('phone'));
                data.append(FORM_FIELDS.doctorName, doctor);
                data.append(FORM_FIELDS.date, date);
                data.append(FORM_FIELDS.fileNumber, formData.get('fileNumber')); 
                
                try {
                    await fetch(GOOGLE_FORM_URL, {
                        method: 'POST',
                        body: data,
                        mode: 'no-cors', 
                    });
                    console.log("Submitted to Google Forms (no-cors assumed success)");
                    return true;
                } catch (error) {
                    console.warn('Google Forms Submission warning (network error ignored in no-cors):', error);
                    return true; 
                }
            };

            // ูุนุงูุฌ ุญุฏุซ ุฅุฑุณุงู ุงููููุฐุฌ ุงูุฑุฆูุณู
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                // 1. ุงูุชุญูู ุงููุญูู ุงูุณุฑูุน
                if (!checkLocalValidation()) {
                    return;
                }

                statusMessage.classList.add('hidden');

                const formData = new FormData(form);
                const date = formData.get('date');
                const doctor = formData.get('doctorName');

                const bookingData = {
                    childName: formData.get('childName'),
                    phone: formData.get('phone'),
                    doctor: doctor,
                    date: date,
                    fileNumber: formData.get('fileNumber') || 'N/A',
                };
                
                // ๐ด ุจุฏุก ุญุงูุฉ ุงูุชุญููู ูุงูุฏูุฑุงู
                submitBtn.disabled = true;
                buttonText.textContent = 'ุฌุงุฑู ุงูุญุฌุฒ ูุงูุชุญูู...';
                buttonIcon.classList.add('animate-spin');
                buttonIcon.setAttribute('data-lucide', 'loader');
                lucide.createIcons();

                try {
                    // 2. ุฅุฑุณุงู ุฅูู API ููุญูุธ ูุงูุชุญูู ูู ุงูุณุนุฉ (ุฎุทูุฉ ุดุจููุฉ ูุงุญุฏุฉ)
                    const apiResponse = await sendBookingToApi(bookingData);
                    
                    // 3. ุฅุทูุงู ุงูุฅุฑุณุงู ุฅูู Google Forms ูู ุงูุฎูููุฉ (ูุง ููุชุธุฑ ุงูุชูุงูู)
                    submitFormToGoogleForms(formData).catch(err => {
                        console.error('Background Google Forms submission failed:', err);
                    });

                    // 4. ุนุฑุถ ุงููุฌุงุญ ุงูููุฑู (ุจุงุณุชุฎุฏุงู ุจูุงูุงุช API)
                    const newRemainingSlots = apiResponse.remainingSlots;
                    const newCurrentCount = MAX_BOOKINGS_PER_DOCTOR_PER_DAY - newRemainingSlots;

                    showSuccessModal(date, doctor); 
                    
                    // ุชุญุฏูุซ ุฑุณุงูุฉ ุงูุณุนุฉ
                    currentCountText.innerHTML = `ุชู ุญุฌุฒ <strong>${newCurrentCount}</strong> ููุนุฏุงู ููุฐุง ุงูุทุจูุจ. ุชุจูู <strong>${newRemainingSlots}</strong> ููุนุฏุงู ูุชุงุญุงู.`;
                    dailyLimitInfo.classList.remove('hidden');

                    form.reset(); 
                    checkLocalValidation(); // ุฅุนุงุฏุฉ ุงูุชุญูู ุงููุญูู ูุชูุธูู ุงููููุฐุฌ

                } catch (error) {
                    console.error('Final Submission Error:', error);
                    
                    showStatusMessage(error.message || 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน ุฃุซูุงุก ุฅููุงู ุงูุญุฌุฒ. ูุฑุฌู ูุฑุงุฌุนุฉ ุงุชุตุงูู ุจุงูุฎุงุฏู.', 'error');
                    
                } finally {
                    // ๐ข ุงุณุชุนุงุฏุฉ ุญุงูุฉ ุงูุฒุฑ
                    buttonText.textContent = 'ุชุฃููุฏ ูุญุฌุฒ ุงูููุนุฏ';
                    buttonIcon.classList.remove('animate-spin');
                    buttonIcon.setAttribute('data-lucide', 'send');
                    lucide.createIcons();
                    submitBtn.disabled = false;
                    checkLocalValidation(); // ููุชุญูู ูู ุฃู ุชุบููุฑุงุช
                }
            };

            // ุฏุงูุฉ ูุนุฑุถ ุฑุณุงูุฉ ุงูุญุงูุฉ (ุชุณุชุฎุฏู ุงูุขู ููุฎุทุฃ ููุท)
            const showStatusMessage = (message, type) => {
                statusMessage.classList.add('hidden'); 
                statusMessage.textContent = message;
                statusMessage.classList.remove('bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');
                
                if (type === 'error') {
                    statusMessage.classList.add('bg-red-100', 'text-red-800');
                }
                statusMessage.classList.remove('hidden'); 
            };

            // ุฏุงูุฉ ูุนุฑุถ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ูููุฌุงุญ
            const showSuccessModal = (date, doctor) => {
                const dateParts = date.split('-'); // YYYY-MM-DD
                const formattedDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`; // DD/MM/YYYY

                bookedDetails.textContent = `${formattedDate} - ${doctor}`;

                // ุฅุธูุงุฑ ุงูููุฏุงู ูุน ุชุฃุซูุฑุงุช ุงูุญุฑูุฉ
                successModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10); 
            };

            // ุฏุงูุฉ ูุฅุฎูุงุก ุงููุงูุฐุฉ ุงูููุจุซูุฉ ูููุฌุงุญ
            const hideSuccessModal = () => {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    successModal.classList.add('hidden');
                }, 300); 
            };


            const setupEventListeners = () => {
                 // ุฑุจุท ุงูุชุญูู ุงููุญูู ุงูุณุฑูุน ุจุชุบููุฑ ุงูุชุงุฑูุฎ ูุงุฎุชูุงุฑ ุงูุทุจูุจ
                dateInput.addEventListener('change', checkLocalValidation);
                doctorNameInput.addEventListener('change', checkLocalValidation);
                
                // ูุนุงูุฌ ุญุฏุซ ุฅุฑุณุงู ุงููููุฐุฌ
                form.addEventListener('submit', handleSubmit);
                
                // ูุนุงูุฌ ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
                closeModalBtn.addEventListener('click', hideSuccessModal);
                successModal.addEventListener('click', (e) => {
                    if (e.target === successModal) {
                        hideSuccessModal();
                    }
                });
            }

            setupEventListeners();
            checkLocalValidation(); // ุงูุชุญูู ุนูุฏ ุงูุชุญููู

        });

    </script>
</body>
</html>
